# Workshop: Customer Service Assistant - Intelligent Routing System

Workshop นี้มุ่งเน้นการพัฒนา Intelligent Routing System สำหรับ Customer Service Assistant โดยใช้ Langflow เป็นเครื่องมือในการสร้าง Flow และเชื่อมต่อคอมโพเนนต์ต่างๆ

## จุดประสงค์การเรียนรู้

- เข้าใจหลักการทำงานของระบบคัดแยกข้อความอัตโนมัติ (text classification)
- เรียนรู้การออกแบบ flow การตัดสินใจและส่งต่อคำถามใน Langflow
- พัฒนาทักษะการกำหนดเกณฑ์ความเร่งด่วนของปัญหาโดยใช้ AI
- เข้าใจการเชื่อมต่อระบบ Langflow กับระบบ ticketing ภายนอก

## โครงสร้างของระบบ

```
1. รับข้อความคำถามจากลูกค้า (Chat Input)
   │
2. ประมวลผลข้อความด้วย LLM (Chat Model)
   │
3. วิเคราะห์และแยกหมวดหมู่คำถาม (Classification Tool)
   │
4. กำหนดระดับความเร่งด่วน (Priority Determination)
   │
5. ค้นหาข้อมูลเพิ่มเติมจากฐานข้อมูล (Data Retrieval)
   │
6. สร้างตั๋วงานในระบบ (Ticket Creation)
   │
7. ส่งต่อไปยังแผนกที่เหมาะสม (Department Routing)
   │
8. ตอบกลับลูกค้าเบื้องต้น (Automated Response)
```

## คอมโพเนนต์ที่จำเป็น

1. **Chat Input** - รับข้อความจากลูกค้า
2. **Chat Model (LLM)** - ประมวลผลข้อความ (เช่น OpenAI, Ollama หรือโมเดลอื่นๆ)
3. **Prompt** - สร้าง prompt สำหรับการวิเคราะห์
4. **Python Function** - สร้าง function สำหรับจำลองการสร้างตั๋วงาน
5. **Memory** - จัดเก็บบริบทการสนทนา
6. **File** - โหลดไฟล์ข้อมูลตัวอย่าง
7. **Chat Output** - แสดงผลลัพธ์

## ตัวอย่าง Prompt สำหรับการวิเคราะห์

```
คุณเป็นระบบวิเคราะห์และคัดแยกคำถามลูกค้าอัตโนมัติ ให้วิเคราะห์ข้อความต่อไปนี้:

"{customer_question}"

โปรดวิเคราะห์และใส่ข้อมูลในรูปแบบ JSON ดังนี้:
{
  "customer_info": "ข้อมูลลูกค้าที่พบในข้อความ (ถ้ามี)",
  "message": "{customer_question}",
  "category": "หมวดหมู่ของปัญหา (การจัดส่ง, เทคนิค, การเงิน, ผลิตภัณฑ์, ข้อเสนอแนะ, ข้อมูลทั่วไป, ฉุกเฉิน)",
  "priority": "ระดับความเร่งด่วน (สูงมาก, สูง, ปานกลาง, ต่ำ)",
  "department": "แผนกที่ควรรับผิดชอบ (แผนกโลจิสติกส์, แผนกเทคนิค/ไอที, แผนกขาย, แผนกบริการสินค้า, แผนกการเงิน, แผนกพัฒนาผลิตภัณฑ์, แผนกบริการลูกค้า, แผนกฉุกเฉิน)"
}

การตัดสินระดับความเร่งด่วน:
- สูงมาก: ปัญหาเกี่ยวกับความปลอดภัย, การทุจริต, ระบบไม่ทำงานที่กระทบลูกค้าจำนวนมาก
- สูง: ปัญหาการเงิน, การยกเลิกคำสั่งซื้อ, ปัญหาทางเทคนิคที่ทำให้ใช้งานไม่ได้
- ปานกลาง: การจัดส่งล่าช้า, สินค้าเสียหาย, ปัญหาการคืนสินค้า
- ต่ำ: คำถามทั่วไป, ข้อเสนอแนะ, ขอข้อมูลเพิ่มเติม
```

## ตัวอย่าง Python Function สำหรับสร้างตั๋วงาน

```python
def create_ticket(customer_info: str, message: str, category: str, priority: str, department: str):
    """
    จำลองการสร้างตั๋วงานในระบบ
    
    Args:
        customer_info: ข้อมูลลูกค้า
        message: ข้อความคำถามหรือปัญหา
        category: หมวดหมู่ของปัญหา
        priority: ระดับความเร่งด่วน
        department: แผนกที่รับผิดชอบ
    
    Returns:
        Dictionary ที่มีข้อมูลตั๋วงานที่สร้างขึ้น
    """
    import datetime
    import random
    
    # สร้าง ID ตั๋วงานแบบสุ่ม
    ticket_id = f"TN-{datetime.datetime.now().strftime('%Y-%m-%d')}-{random.randint(1000, 9999)}"
    
    # สร้างเวลาตอบสนองตามระดับความเร่งด่วน
    response_time = {
        "สูงมาก": "30 นาที",
        "สูง": "3 ชั่วโมง",
        "ปานกลาง": "24 ชั่วโมง",
        "ต่ำ": "72 ชั่วโมง"
    }
    
    # สร้างรายละเอียดตั๋วงาน
    ticket = {
        "ticket_id": ticket_id,
        "created_at": datetime.datetime.now().isoformat(),
        "customer_info": customer_info,
        "message": message,
        "category": category,
        "priority": priority,
        "department": department,
        "status": "open",
        "estimated_response_time": response_time.get(priority, "24 ชั่วโมง"),
        "assigned_to": f"พนักงานแผนก{department}"
    }
    
    return ticket
```

## ตัวอย่างข้อมูลสำหรับการทดสอบ

ตัวอย่างคำถามลูกค้าที่หลากหลายรูปแบบ:

1. "ฉันสั่งซื้อสินค้าเมื่อ 5 วันที่แล้ว แต่ยังไม่ได้รับการจัดส่ง หมายเลขคำสั่งซื้อคือ ON78965412"
2. "แอพของคุณเด้งออกทุกครั้งที่ฉันพยายามเข้าสู่ระบบ"
3. "ฉันถูกเรียกเก็บเงินสองครั้งสำหรับคำสั่งซื้อเดียวกัน"
4. "กล้องวงจรปิดของฉันตรวจจับการเคลื่อนไหวที่น่าสงสัย ฉันต้องการความช่วยเหลือทันที"
5. "SmartHome Hub รุ่นใหม่สามารถเชื่อมต่อกับอุปกรณ์ Apple HomeKit ได้หรือไม่?"

## ขั้นตอนการทำ Workshop

1. **เริ่มต้น**
   - อธิบายแนวคิดและวัตถุประสงค์ของ Intelligent Routing System
   - นำเข้าข้อมูลตัวอย่างจากไฟล์ CSV

2. **ขั้นที่ 1: สร้างส่วนรับข้อความและวิเคราะห์หมวดหมู่**
   - สร้าง Chat Input Component
   - เชื่อมต่อกับ Chat Model (LLM)
   - สร้าง Prompt Component สำหรับการวิเคราะห์

3. **ขั้นที่ 2: สร้าง Function สำหรับจำลองการสร้างตั๋วงาน**
   - สร้าง Python Function Component
   - กำหนดโค้ดสำหรับการสร้างตั๋วงาน

4. **ขั้นที่ 3: เชื่อมต่อระบบทั้งหมด**
   - เชื่อมต่อผลลัพธ์จาก LLM ไปยัง Python Function
   - สร้าง Memory Component สำหรับจดจำบริบทการสนทนา

5. **ขั้นที่ 4: สร้างส่วนตอบกลับลูกค้าอัตโนมัติ**
   - สร้าง Chat Output Component
   - เชื่อมต่อผลลัพธ์จากการสร้างตั๋วงานไปยัง Chat Output

6. **ขั้นที่ 5: ทดสอบและปรับแต่ง**
   - ทดสอบระบบด้วยคำถามหลากหลายประเภท
   - ปรับปรุง Prompt และโค้ดตามความเหมาะสม

## ไฟล์ข้อมูลที่เตรียมไว้

1. **customer-questions.csv** - ตัวอย่างคำถามลูกค้าและการจัดหมวดหมู่
2. **priority-criteria.csv** - เกณฑ์การกำหนดความเร่งด่วน
3. **departments.csv** - ข้อมูลแผนกและหมวดหมู่
4. **ticket-template.csv** - เทมเพลตโครงสร้างตั๋วงาน

## เคล็ดลับเพิ่มเติม

1. การปรับแต่ง Prompt เป็นกุญแจสำคัญในการเพิ่มความแม่นยำให้กับการวิเคราะห์
2. ควรเพิ่ม Memory Component เพื่อให้ระบบจดจำบริบทการสนทนา
3. การปรับค่า Temperature ของ LLM มีผลต่อความแม่นยำในการวิเคราะห์
4. สำหรับระบบจริง ควรเชื่อมต่อกับฐานข้อมูลเพื่อเก็บประวัติการสนทนาและข้อมูลลูกค้า

## การพัฒนาต่อยอด

1. เพิ่มความสามารถในการ fine-tuning โมเดลด้วยข้อมูลการจำแนกหมวดหมู่ที่ถูกต้อง
2. พัฒนาระบบประเมินคุณภาพการวิเคราะห์และคัดแยก
3. เพิ่มความสามารถในการเชื่อมต่อกับระบบ CRM หรือ Helpdesk อื่นๆ
4. พัฒนาส่วนแสดงผลแบบ Dashboard สำหรับติดตามประสิทธิภาพของระบบ
